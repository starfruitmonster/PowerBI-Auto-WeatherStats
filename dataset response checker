import requests
import os

# Set environment variables or replace directly
client_id = os.getenv("CLIENT_ID", "CLIENT ID")
client_secret = os.getenv("CLIENT_SECRET", "CLIENT SECRET")
refresh_token = os.getenv("REFRESH_TOKEN", "REFRESH TOKEN")
tenant_id = os.getenv("TENANT_ID", "common")

# Your known workspace (group) and dataset ID
group_id = "DATASET GROUP ID"
dataset_id = "DATASET ID"

# Get access token
token_url = f"https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token"
token_data = {
    "client_id": client_id,
    "client_secret": client_secret,
    "refresh_token": refresh_token,
    "grant_type": "refresh_token",
    "scope": "https://analysis.windows.net/powerbi/api/.default"
}
token_res = requests.post(token_url, data=token_data)
access_token = token_res.json().get("access_token")

if not access_token:
    print("Failed to retrieve token:", token_res.text)
    exit(1)

# Call the GET tables endpoint
url = f"https://api.powerbi.com/v1.0/myorg/groups/{group_id}/datasets/{dataset_id}/tables"
headers = {
    "Authorization": f"Bearer {access_token}"
}

response = requests.get(url, headers=headers)

print("Status Code:", response.status_code)
print("Response:")
print(response.text)
